pr: none
trigger: none
schedules:
  - cron: '0 0,8,16 * * *'
    branches:
      include:
      - master
    always: true
    displayName: Starting job
jobs:
  - job: swiftshader
    timeoutInMinutes: 180
    pool:
      vmImage: windows-latest
    strategy:
      maxParallel: 2
      matrix:
        LLVM:
          REACTOR_BACKEND: LLVM
        subzero:
          REACTOR_BACKEND: subzero
    steps:
      - checkout: none
      - script: |
          git clone --depth=1 https://github.com/google/swiftshader.git swiftshader
          git clone https://github.com/pal1000/swiftshader-dist-win.git swiftshader-dist-win
          cd swiftshader-dist-win
          git checkout c4449f5fea37ea56ef4b04bd1cd844421ab8387a
          cd ..
        displayName: Get sources
      - task: Cache@2
        inputs:
          key: sources-UIDs | $(REACTOR_BACKEND)
          path: swiftshader-dist-win\buildscript\ci\assets
        displayName: Restoring previous build unique identifiers
      - script: swiftshader-dist-win\buildscript\ci\ci.cmd $(REACTOR_BACKEND)
        displayName: Build swiftshader
      - publish: swiftshader-dist-win\swiftshader-$(artifactuid)-$(REACTOR_BACKEND).7z
        artifact: swiftshader-$(artifactuid)-$(REACTOR_BACKEND).7z